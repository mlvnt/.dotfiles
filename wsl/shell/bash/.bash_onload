#!/bin/bash
#   -------------------------------
#   ONLOAD FUNCTIONS
#   -------------------------------

sca() {
    # Shell dotfiles
    files=(
        "bash_onload"
        "bashrc"
        # "bash_aliaswin"
        "bash_var"
        "bash_alias"
        "bash_env"
        "bash_fun"
        "fzf.bash" # fzf - A command-line fuzzy finder
        # "tmux.conf"
        # "zshrc"
        # "yarnrc"
        # "vimrc"
        # "bash_private"
        # "bash-powerline.sh"
        # "rvm/scripts/rvm"
    );

    case $1 in
        i) files=( "${files[@]:2}" ); ;;
        *) files=( "${files[1]}" );
           printing="true"; ;;
    esac

    # Load the shell dotfiles
    [ "$printing" == "true" ] && printf "\n";
    for f in "${files[@]}"; do
        f="$HOME/.$f"
        if [ -r "$f" ] && [ -f "$f" ]; then
            if [ "$f" == "$HOME/.tmux.conf" ]; then
                tmux source-file "$f";
                [ "$printing" == "true" ] && printf "[sourcing] $f\n";
            else
                source "$f";
                [ "$printing" == "true" ] && printf "[sourcing] $f\n";
            fi
        else
            printf "404: $f not found.\n";
        fi
    done;
    [ "$printing" == "true" ] && printf "\n";
    # clear
    unset files f printing;
}

#-------------------------------------------------------------------------------

currentdevice() {
    help() {
        echo && echo "DESCRIPTION"
        echo "        currentdevice - show info about current device" && echo
        echo "USAGE"
        echo "        currentdevice [OPTION]" && echo
        echo "OPTIONS"
        echo "    -hn           show device hostname"
        echo "     -u           show current user"
        echo "     -o           show operating system"
        echo "     -h | help    show help" && echo
    }

    local user=$(whoami);
    local hostname=$(hostname); # uname -n
    local os=$(uname -a | grep -qw 'Microsoft' && echo "win" || echo "unix");
    case $1 in
        -hn)        echo "$hostname" ;;
        -u)         echo "$user" ;;
        -o)         echo "$os" ;;
        -h|help)    help ;;
        *)
            case $user in
                todorov)
                            case $hostname in
                                DESKTOP-6QS0DON) echo "surface" ;;
                                DESKTOP-HMLNHB8) echo "pc" ;;
                            esac; ;;
                u0_a802)    echo "s8" ;;
                u0_a105)    echo "tab" ;;
                root)
                            case $hostname in
                                DESKTOP-6QS0DON) echo "surface" ;;
                                DESKTOP-HMLNHB8) echo "pc" ;;
                                localhost)       echo "mobile" ;;
                            esac; ;;
            esac;
    esac;
    unset -f help;
}


#-------------------------------------------------------------------------------

path_converter() {
    new_path=$(cmd.exe /c "echo $@" 2>&1 | tr -d "\r\n");
    echo "$new_path";
}

#-------------------------------------------------------------------------------

tmux_workspace() {
    local SESSION_NAME="wkse";
    local process=$(ps -e);
    local tasks=$(cmd.exe /c tasklist);
    # tmux set -g base-index 1;
    tmux new -d -s ${SESSION_NAME};
    tmux rename-window 'whole';
    tmux split-window -v -p 50;
    tmux resize-pane -Z -t 1.0;
    tmux new-window -n 'whole';
    tmux split-window -v -p 50;
    tmux resize-pane -Z -t 2.0;

    if [[ $(currentdevice) == pc ]]; then
        tmux new-window -n 'todo' \; split-window \; split-window \;
        echo ${tasks} | grep -qw 'MyBot.run' || tmux send-keys -t 3.0 'coc' Enter;
        tmux select-layout tiled;
        tmux send-keys -t 3.0 'lin' Enter;
        tmux send-keys -t 3.1 'radicalle run' Enter;
        echo $process | grep -qw sshd || tmux send-keys -t 3.2 'sudo /usr/sbin/sshd' Enter;
        echo $process | grep -qw dbus || tmux send-keys -t 3.2 'sudo /etc/init.d/dbus start' Enter;
        tmux send-keys -t 3.2 'todo' Enter;
        tmux resize-pane -Z -t 3.2;
    else
        tmux new-window -n 'todo';
        echo $process | grep -qw sshd || tmux send-keys -t 3.0 'sudo /usr/sbin/sshd' Enter;
        echo $process | grep -qw dbus || tmux send-keys -t 3.0 'sudo /etc/init.d/dbus start' Enter;
        tmux send-keys -t 3.0 'todo' Enter;
    fi;

    tmux select-window -t 1;
    tmux send-keys -t 1.1 'update' Enter;
    # tmux send-keys -t 1.0 'neofetch' Enter;
    # tmux send-keys -t 2.0 'fzf' Enter;
    # tmux select-pane -t 0;
    tmux attach -t ${SESSION_NAME};
}

#-------------------------------------------------------------------------------
